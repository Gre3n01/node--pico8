pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- node.p8
-- base game: node in the lobby

--==[ constants ]==--
-- wall sprite numbers
wall_sprites = {64,65,66,80,81,82,96,97,98}

-- map chunk for lobby
lobby_x1, lobby_y1 = 1, 1
lobby_x2, lobby_y2 = 11, 4

-- room ids
room_lobby = 1

--==[ global variables ]==--
roomid = room_lobby
room_name = "lobby"
room_name_timer = 0

-- player object
node = {}

--==[ common functions ]==--

-- check if a sprite is a wall
function is_wall(tile)
 for i=1,#wall_sprites do
  if tile == wall_sprites[i] then
   return true
  end
 end
 return false
end

-- display the room name for a short time
function show_room_name(name)
 room_name = name
 room_name_timer = 120 -- 2 seconds at 60fps
 sfx(0) -- play "enter room" sound
end

--==[ character creation ]==--

function create_node()
 node = {
  x = 2*8, -- start at map tile x=2 (pixels)
  y = 2*8, -- start at map tile y=2 (pixels)
  spr = 1, -- sprite number
  spd = 2, -- movement speed (pixels per frame)
  w = 8,   -- width
  h = 8    -- height
 }
end

--==[ character movement ]==--

function move_node()
 local dx, dy = 0, 0

 -- arrow keys
 if btn(0) or btn(⬅️) or btn(4) then dx = dx - 1 end -- left or 'a'
 if btn(1) or btn(➡️) or btn(5) then dx = dx + 1 end -- right or 'd'
 if btn(2) or btn(⬆️) or btn(6) then dy = dy - 1 end -- up or 'w'
 if btn(3) or btn(⬇️) or btn(7) then dy = dy + 1 end -- down or 's'

 -- normalize diagonal movement
 if dx ~= 0 and dy ~= 0 then
  dx *= 0.7071
  dy *= 0.7071
 end

 -- controller support (pico-8 handles this automatically with btn())

 -- try to move, but check for wall collisions
 try_move_node(dx * node.spd, dy * node.spd)
end

-- check for wall collision and move if possible
function try_move_node(dx, dy)
 local new_x = node.x + dx
 local new_y = node.y + dy

 -- check all four corners for wall collision
 if not is_solid(new_x, new_y) and
    not is_solid(new_x+node.w-1, new_y) and
    not is_solid(new_x, new_y+node.h-1) and
    not is_solid(new_x+node.w-1, new_y+node.h-1) then
  node.x = new_x
  node.y = new_y
 end
end

-- check if a pixel position is solid (wall)
function is_solid(px, py)
 local tx = flr(px/8)
 local ty = flr(py/8)
 local tile = mget(tx, ty)
 return is_wall(tile)
end

--==[ room management ]==--

function get_room_name(id)
 if id == 1 then return "lobby" end
 -- add more rooms here later
 return "???"
end

--==[ pico-8 builtins ]==--

function _init()
 create_node()
 show_room_name(get_room_name(roomid))
end

function _update()
 move_node()

 -- room name timer
 if room_name_timer > 0 then
  room_name_timer -= 1
 end
end

function _draw()
 cls()

 -- draw the map (lobby only for now)
 map(lobby_x1, lobby_y1, 0, 0, lobby_x2-lobby_x1+1, lobby_y2-lobby_y1+1)

 -- draw node
 spr(node.spr, node.x, node.y)

 -- draw room name if timer > 0
 if room_name_timer > 0 then
  rectfill(32, 2, 96, 14, 0)
  print(room_name, 40, 6, 7)
 end
end

--==[ end of base game ]==--
-- add new features below this line!
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111080000800505607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111100e00e000600006000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111110e0880e0000dd00000099900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000ee000000550000099aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000099f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dddddddddddddddddd00000d444d009a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dddddddddddddddddd00000d444d009ddd6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd55555555555555dd000005444500990d0d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000d444d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dd00000000000000dd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dddddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000dddddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999000009990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
099a9900009a90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999000009990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4041414141414141414141414200404141414141414142000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000001000001010100000005200500010101010100052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000101010101010101010005200501010101010100052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000101010101010101010005200501010101010100052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000001010000000101010005200500010101010100052000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6061616161616161616161616200606161616161616162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000500000b0500f050130501705000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000800002f05033050360500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00080000120500f0500c0500605006050060500605000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
